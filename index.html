<!DOCTYPE html>
<!-- RESPONSIVE-PROTOTYPE -->
<!-- Everything is in one file to modularize ngRWD show how it works and to easily refactor. -->
<!-- It includes 
         angular-responsive: 
         breakpoint event:
         loading partials
-->
      
<html lang="en" ng-app="myApp">
<head>
    <meta charset="utf-8">
    <title>Responsive Prototype</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Jim Lavin, Clint Nash">

</head>
<body>

<!--Responsive-Content-->
<div class="container-fluid" ng-controller="responsiveController">
    <div class="row-fluid">
        <h2>Responsive Prototype</h2>
        <hr>
        <div eg-mobile>
            <hr>
            <h1>Mobile</h1> {{ email }}
            <img ng-src="http://betanews.com/wp-content/uploads/2012/02/businessready.jpg" src="" alt="mobile"
                 width="50" height="50"/>
            <pre> mobile image</pre>
            <hr>
            <pre>Partial Content</pre>
            <div eg-example-partial-mobile></div>
            <hr>
            <pre>Partial Content - ng-include</pre>
            <div ng-include src="'./components/examplePartial/mobile/exampleInclude.html'" onload='responsiveIncludeLoad()'></div>
        </div>
        <div eg-tablet>
            <hr>
            <h1>Tablet</h1> {{ email }}
            <img ng-src="http://www1.pcmag.com/media/images/320913-tablet-satisfaction.jpg" src="" alt="tablets"
                 width="50" height="50"/>
            <pre> tablet image</pre>
            <hr>
            <pre>Partial Content</pre>
            <div eg-example-partial-tablet></div>
            <hr>
            <pre>Partial Content - ng-include</pre>
            <div ng-include src="'./components/examplePartial/tablet/exampleInclude.html'" onload='responsiveIncludeLoad()'></div>
        </div>
        <div eg-desktop>
            <hr>
            <h1>Desktop</h1> {{ email }}
            <img ng-src="http://cdn.arstechnica.net/wp-content/uploads/2012/08/Acer-Aspire-A5560-7414.png" src=""
                 alt="desktop" width="50" height="50"/>
            <pre> desktop image</pre>
            <hr>
            <pre>Partial Content - directive.templateUrl</pre>
            <div eg-example-partial-desktop></div>
            <hr>
            <pre>Partial Content - ng-include</pre>
            <div ng-include src="'./components/examplePartial/desktop/exampleInclude.html'" onload='responsiveIncludeLoad()'></div>
        </div>
        <div eg-responsive="{ 'Mobile': true, 'Tablet': true, 'Desktop': false }">
            <hr>
            Both Mobile and Tablet (hybrid example)
            <img ng-src="http://mygooseworks.com/home/images/stories/mobiledevices.jpg" src="" alt="tablets and mobile"
                 width="50" height="50"/>
            <pre>hybrid image</pre>
            <hr>
        </div>
    </div>
</div>

<br><hr><hr>
<div style="font-size:.75em;">
<h3>Directions</h3>
- Right Click -> Inspect Element<br>
- Emulation Tab -> Combo -> Apple Iphone 4 -> Click Emulate button.
- Refresh (must click refresh)
<h3>Overview</h3>
- Great for Templates/Images that differ substantially between device.
- This is a template file for reusable; standardization, extension, and testing.<br>
<h3>Benefits:</h3>
- A la Carte - user only gets what user orders (images/includes).<br>
- Separation of concerns - device logic is removed from view making it maintainable.<br>
- Semantic-HTML - Template clearly identifies device intention.
- Each device then re-uses directives.<br>
<h3>Downsides:</h3>
- Refresh not Resize. Because Angular lazy-loads a-la-carte, resize is no longer emulates device.<br>
- Emulation. Need to use Device Emulation tools for testing cross-device (good-thing).<br>
- Due Diligence. We need to ensure full-functionality in all (of many) cases.<br>
- For example, directive.urlTemplate - currently loads all partials (fix pending).
</div>

<!--Responsive-Screen-Indicator-Style-->
<style>
  .develop-responsive-status-indicator{
    position: absolute;
    bottom: 0px;
    right: 0px;
    background-color:#ccc;
    border: 1px solid #333;
    padding: 1px;
    border-radius: 8px;
    font-size: .25em;
  }
</style>

<!--Responsive-Screen-Indicator-Markup-->
<div id="responsive-update" eg-responsive-update  class="develop-responsive-status-indicator">
    <div eg-mobile>
        <span>mobile</span>
    </div>
    <div eg-tablet class="develop-responsive-status-indicator">
        <span>tablet</span>
    </div>
    <div eg-desktop class="develop-responsive-status-indicator">
        <span>desktop</span>
    </div>
</div>

<!--Angular-Include-At-The-Top-->
<script src="./angular/angular.js"></script>

<!--Responsive-Directive-->
<!--script src="./responsive-directives.js"></script-->
<script>
(function ( angular ) {
    'use strict';

    angular
        .module('angular-responsive', [])
        .provider('responsiveHelper', ["$windowProvider", function ($windowProvider)
        {
            // Gather winWidth and smartDevice information only 1x at app startup...

            var $window  = $windowProvider.$get();
            var winWidth = $window['outerWidth'];
            var helper   = {

                isSmartDevice : isSmartDevice( $window ),
                isMobile      : function () { return helper.isSmartDevice && (winWidth <= 767);   },
                isTablet      : function () { return helper.isSmartDevice && (winWidth > 767);    },
                isDesktop     : function () { return !helper.isSmartDevice;                       }

            };

            // Publish accessor function...

            this.$get = function() {
                return helper;
            };
        }])

        /**
         * Is this a limited-display-size mobile device
         */
        .directive('egMobile', ['responsiveHelper', function (responsiveHelper)
        {
            return {
                restrict    : "EAC",
                transclude  : 'element',
                template    : '<div></div>',
                compile     : buildCompileFn( 'egMobile', responsiveHelper.isMobile )
            };
        }])

        /**
         * Is this a table device
         */
        .directive('egTablet', ['responsiveHelper', function (responsiveHelper)
        {
            return {
                restrict    : "EAC",
                transclude  : 'element',
                template    : '<div></div>',
                compile     : buildCompileFn( 'egTablet', responsiveHelper.isTablet )
            };
        }])

        /**
         * Is this a desktop device
         */
        .directive('egDesktop', ['responsiveHelper', function (responsiveHelper)
        {
            return {
                restrict    : "EAC",
                transclude  : 'element',
                template    : '<div></div>',
                compile     : buildCompileFn( 'egDesktop', responsiveHelper.isDesktop )
            };
        }])

        /**
         * Does the device a match user-specified combination (0..3) of device types
         */
        .directive('egResponsive', ['responsiveHelper', function (responsiveHelper)
        {
            return {
                restrict    : "EAC",
                transclude  : 'element',
                template    : '<div></div>',
                compile     : buildCompileFn( 'egResponsive', checkAllTypes(responsiveHelper) )
            };
        }])

        /**
         * Update Directive. Updates Angular on Screen Size Change-.
         */
        .directive('egResponsiveUpdate', ['$window', function ($window)
        {
            return {
                restrict: "ACE",
                link: function(scope, element, attr){
                    scope.breakpoint = {class:'', windowSize:$window.innerWidth }; // Initialise Values

                    angular.element($window).bind('resize', setWindowSize);        // Bind Resize Event

                    function setWindowSize (){
                        element.html('REFRESH')
                        scope.$apply();
                    }

                }
            };
        }]);

    /**
     * Partial application for DRY construction of a directive compile function
     */
    function buildCompileFn(responsiveType, verifyFn )
    {
        return function compile(element, attr, transclude)
        {
            return function postLink(scope, element, attr)
            {
                var childElement, childScope,
                    config  = scope.$eval( attr[responsiveType] ),
                    unwatch = scope.$watch( config, function ()
                    {
                        // attribute changed, delete existing element & $scope

                        if (childElement) {
                            childElement.remove();
                            childScope.$destroy();
                            childElement = undefined;
                            childScope = undefined;
                        }

                        if ( verifyFn(config) )
                        {
                            // Create a new element and $scope...

                            childScope = scope.$new();
                            childElement = transclude(childScope, function (clone) {
                                element.after(clone);
                            });
                        }
                    });

                // Fix memory leak an remove watcher when element/directive is released

                scope.$on( "$destroy", unwatch );
            };
        };
    }

    /**
     * Partial application for DRY construction of function to scan of any valid responsive types
     */
    function checkAllTypes(responsiveHelper)
    {
        return function( deviceTypes )
        {
            return  ( deviceTypes['Mobile']  && responsiveHelper.isMobile()  ) ||
                ( deviceTypes['Tablet']  && responsiveHelper.isTablet()  ) ||
                ( deviceTypes['Desktop'] && responsiveHelper.isDesktop() ) || false;
        };
    }

    /**
     * Scan to determine if current window is hosted within a `smart` device
     * @param $window
     * @returns {boolean}
     */
    function isSmartDevice( $window )
    {
        // Adapted from http://www.detectmobilebrowsers.com
        var ua = $window['navigator']['userAgent'] || $window['navigator']['vendor'] || $window['opera'];

        // Checks for iOs, Android, Blackberry, Opera Mini, and Windows mobile devices
        return (/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/).test(ua);
    }

})( window.angular );
</script>

<!--Responsive-Controller-With-Data-->
<!--script src="./samples/app/app/app.js"></script-->
<script>
    'use strict';

    // Declare app level module which depends on filters, and services
    var respApp = angular.module('myApp', ['angular-responsive']);

    function responsiveController($scope) {
        $scope.email = 'example.data.transclusion';
    }

    /* script src="./directives/examplePartial.js" */
    respApp.directive('egExamplePartialDesktop', [ function () {
        return {
          restrict: 'EA',
          scope: true,
          templateUrl: './components/examplePartial/desktop/examplePartial.html',
          link: function ($scope, $element, $attrs) {
            //Any-Directive-Logic-.
          }
        }
    }]);

    respApp.directive('egExamplePartialTablet', [ function () {
        return {
          restrict: 'EA',
          scope: true,
          templateUrl: './components/examplePartial/tablet/examplePartial.html',
          link: function ($scope, $element, $attrs) {
            //Any-Directive-Logic-.
          }
        }
    }]);

    respApp.directive('egExamplePartialMobile', [ function () {
        return {
          restrict: 'EA',
          scope: true,
          templateUrl: './components/examplePartial/mobile/examplePartial.html',
          link: function ($scope, $element, $attrs) {
            //Any-Directive-Logic-.
          }
        }
    }]);

</script>

<script>
function responsiveIncludeLoad(){
    alert('here');
}
</script

</body>
</html>
